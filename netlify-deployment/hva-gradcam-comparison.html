<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Analysis Comparison Study - HVA-X vs Grad-CAM</title>
    <style>
        /* Add new game-intro styles */
        .game-intro {
            background: #e8f4ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4facfe;
        }
        
        .game-intro h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .game-intro ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .game-intro li {
            margin-bottom: 8px;
        }
        
        /* Keep existing styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .language-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .lang-btn {
            padding: 10px 20px;
            border: 2px solid #4facfe;
            background: white;
            color: #4facfe;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .lang-btn.active {
            background: #4facfe;
            color: white;
        }

        .content {
            padding: 40px;
        }

        .phase {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .phase.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .phase-header {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #4facfe;
        }

        .phase-title {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .phase-description {
            font-size: 1.1em;
            color: #34495e;
            line-height: 1.6;
        }

        .video-container {
            margin: 30px 0;
            text-align: center;
        }

        .video-player {
            width: 100%;
            max-width: 800px;
            height: 450px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .report-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }

        .report-content {
            font-size: 1em;
            line-height: 1.6;
            color: #2c3e50;
        }

        .report-content h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .report-content h2 {
            color: #34495e;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
        }

        .report-content h3 {
            color: #495057;
            margin: 20px 0 10px 0;
            font-size: 1.2em;
        }

        .report-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .report-content li {
            margin-bottom: 8px;
        }

        .gradcam-container {
            margin: 30px 0;
            text-align: center;
        }

        .gradcam-video {
            width: 100%;
            max-width: 800px;
            height: 450px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .gradcam-description {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
        }

        .gradcam-description h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .gradcam-description p {
            color: #856404;
            line-height: 1.6;
        }

        .evaluation-item {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #4facfe;
            transition: all 0.3s ease;
        }

        .evaluation-item:hover {
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .dimension-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .statement {
            font-size: 1.1em;
            color: #34495e;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .score-selection {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .score-buttons {
            display: flex;
            gap: 8px;
            flex: 1;
            justify-content: center;
        }

        .score-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #bdc3c7;
            background: white;
            color: #2c3e50;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score-btn:hover {
            border-color: #4facfe;
            background: #e8f4fd;
            transform: scale(1.1);
        }

        .score-btn.selected {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
            transform: scale(1.1);
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #ecf0f1;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ecf0f1;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin: 0 10px;
            position: relative;
        }

        .progress-step.active {
            background: #4facfe;
            color: white;
        }

        .progress-step.completed {
            background: #27ae60;
            color: white;
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 100%;
            width: 20px;
            height: 2px;
            background: #ecf0f1;
            transform: translateY(-50%);
        }

        .progress-step:last-child::after {
            display: none;
        }

        .progress-step.completed::after {
            background: #27ae60;
        }

        .thank-you {
            text-align: center;
            padding: 50px;
        }

        .thank-you h2 {
            color: #27ae60;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .thank-you p {
            font-size: 1.2em;
            color: #34495e;
            line-height: 1.6;
        }

        .randomization-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #27ae60;
        }

        .randomization-info h4 {
            color: #27ae60;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .score-btn {
                width: 40px;
                height: 40px;
                font-size: 1em;
            }
            
            .score-buttons {
                gap: 5px;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="main-title">AI Analysis Comparison Study</h1>
            <p id="subtitle">HVA-X Text Analysis vs Grad-CAM Visualization</p>
        </div>

        <div class="language-toggle">
            <button class="lang-btn active" onclick="setLanguage('en')" id="en-btn">English</button>
            <button class="lang-btn" onclick="setLanguage('zh')" id="zh-btn">中文</button>
        </div>

        <div class="content">
            <div class="progress-indicator">
                <div class="progress-step active" id="step-1">1</div>
                <div class="progress-step" id="step-2">2</div>
                <div class="progress-step" id="step-3">3</div>
                <div class="progress-step" id="step-4">4</div>
            </div>

            <!-- Phase 1: Introduction -->
            <div class="phase active" id="phase-1">
                <div class="phase-header">
                    <h2 class="phase-title" id="intro-title">Welcome & Introduction</h2>
                    <div class="phase-description" id="intro-description">
                        <p>Thank you for participating in this research study about understanding AI behavior.</p>
                        <p>This study will take approximately 15 minutes. Your task is to evaluate two different AI analysis tools to see how effectively they help you understand a game-playing AI.</p>
                        <p>The experiment will be divided into three stages. Please follow the instructions step by step.</p>
                    </div>
                </div>
                
                <div class="randomization-info">
                    <h4 id="randomization-title">Study Design</h4>
                    <p id="randomization-text">To ensure unbiased results, the order of the two analysis methods will be randomized for each participant.</p>
                    <p><strong id="your-order">Your randomized order:</strong> <span id="order-display"></span></p>
                </div>

                <div class="actions">
                    <button class="btn btn-primary" onclick="nextPhase()" id="start-btn">Start Study</button>
                </div>
            </div>

            <!-- Phase 2: Familiarization -->
            <div class="phase" id="phase-2">
                <div class="phase-header">
                    <h2 class="phase-title" id="familiarization-title">Stage 1: Familiarization with Agent Behavior</h2>
                    <div class="phase-description" id="familiarization-description">
                        <p>First, you will watch an unedited game video showing a complete performance of an AI playing Breakout.</p>
                        <p><strong>Viewing Tips: If you find the video content too fast, you can pause, rewind, or adjust the playback speed to better understand the AI's behavior.</strong></p>
                        <p><strong>Your task:</strong> Please watch carefully and try to form an initial impression of this AI's behavioral patterns. This will serve as the baseline for all subsequent evaluations.</p>
                    </div>
                </div>

                <div class="video-container">
                    <video class="video-player" controls id="demo-video">
                        <source src="videos/demo.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>

                <div class="actions">
                    <button class="btn btn-secondary" onclick="prevPhase()" id="back-btn">Back</button>
                    <button class="btn btn-primary" onclick="nextPhase()" id="continue-btn">Continue</button>
                </div>
            </div>

            <!-- Phase 3: First Analysis Method -->
            <div class="phase" id="phase-3">
                <div class="phase-header">
                    <h2 class="phase-title" id="first-method-title">Stage 2: Evaluate First Analysis Method</h2>
                    <div class="phase-description" id="first-method-description">
                        <!-- Content will be populated based on randomization -->
                    </div>
                </div>

                <div id="first-method-content">
                    <!-- Content will be populated based on randomization -->
                </div>

                <div id="first-evaluation-form">
                    <!-- Evaluation form will be generated here -->
                </div>

                <div class="actions">
                    <button class="btn btn-secondary" onclick="prevPhase()" id="back-btn-2">Back</button>
                    <button class="btn btn-primary" onclick="submitFirstEvaluation()" id="submit-first-btn">Submit Evaluation</button>
                </div>
            </div>

            <!-- Phase 4: Second Analysis Method -->
            <div class="phase" id="phase-4">
                <div class="phase-header">
                    <h2 class="phase-title" id="second-method-title">Stage 3: Evaluate Second Analysis Method</h2>
                    <div class="phase-description" id="second-method-description">
                        <!-- Content will be populated based on randomization -->
                    </div>
                </div>

                <div id="second-method-content">
                    <!-- Content will be populated based on randomization -->
                </div>

                <div id="second-evaluation-form">
                    <!-- Evaluation form will be generated here -->
                </div>

                <div class="actions">
                    <button class="btn btn-secondary" onclick="prevPhase()" id="back-btn-3">Back</button>
                    <button class="btn btn-primary" onclick="submitSecondEvaluation()" id="submit-second-btn">Submit Evaluation</button>
                </div>
            </div>

            <!-- Phase 5: Thank You -->
            <div class="phase" id="phase-5">
                <div class="thank-you">
                    <h2 id="thank-you-title">Thank You!</h2>
                    <p id="thank-you-message">Thank you for participating in this study. Your responses have been recorded and will help us improve AI explanation systems.</p>
                    <div class="actions" style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="downloadResults()" id="download-btn">Download Results</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden form for Netlify form detection -->
    <form name="study-results" method="POST" data-netlify="true" style="display: none;">
        <input type="hidden" name="form-name" value="study-results" />
        <input type="hidden" name="study-type" />
        <input type="hidden" name="first-method" />
        <input type="hidden" name="second-method" />
        <input type="hidden" name="language" />
        <input type="hidden" name="order" />
        <input type="hidden" name="timestamp" />
        <input type="hidden" name="first-clarity" />
        <input type="hidden" name="first-understandable" />
        <input type="hidden" name="first-completeness" />
        <input type="hidden" name="first-satisfaction" />
        <input type="hidden" name="first-useful" />
        <input type="hidden" name="first-accuracy" />
        <input type="hidden" name="first-improvement" />
        <input type="hidden" name="first-preference" />
        <input type="hidden" name="second-clarity" />
        <input type="hidden" name="second-understandable" />
        <input type="hidden" name="second-completeness" />
        <input type="hidden" name="second-satisfaction" />
        <input type="hidden" name="second-useful" />
        <input type="hidden" name="second-accuracy" />
        <input type="hidden" name="second-improvement" />
        <input type="hidden" name="second-preference" />
        <input type="hidden" name="results-json" />
    </form>

    <script>
        let currentLanguage = 'en';
        let currentPhase = 1;
        let randomizedOrder = Math.random() < 0.5 ? 'hva-first' : 'gradcam-first';
        let firstEvaluationData = {};
        let secondEvaluationData = {};

        const translations = {
            en: {
                mainTitle: "AI Analysis Comparison Study",
                subtitle: "HVA-X Text Analysis vs Grad-CAM Visualization",
                introTitle: "Welcome & Introduction",
                introDescription: `
                    <p><strong>Welcome!</strong> This study is about <strong>understanding and analyzing the strategy of a game-playing AI agent</strong>. All videos, reports, and methods you will see are designed to help you achieve this goal. <br><span style="color:#4facfe;">If you feel confused or unsure, please don't doubt yourself—sometimes the AI's behavior is hard to interpret, and that's a limitation of the algorithm, not you!</span></p>
                    <p>This study will take about 15 minutes. Your main task is to use two different AI analysis tools to help you understand <strong>how the agent plays and what strategies it uses</strong>. Please focus on forming your own understanding of the agent's behavior and strategy, using all materials as aids.</p>
                    <p><strong>What will you see?</strong> You will first watch a full unedited gameplay video of the agent. Then, you will experience two different AI analysis methods (for example, a text report and a visualization), with the order randomized. Each method is designed to help you analyze and summarize the agent’s behavior and strategy.</p>
                    <div class="game-intro">
                        <h3>About Breakout Game</h3>
                        <p>In this study, the AI plays the classic arcade game <strong>Breakout</strong>:</p>
                        <ul>
                            <li><strong>Basic Control:</strong> The player controls a paddle at the bottom of the screen</li>
                            <li><strong>Objective:</strong> A ball bounces around the screen, breaking bricks at the top</li>
                            <li><strong>Goal:</strong> Clear all bricks without letting the ball fall below the paddle</li>
                            <li><strong>Lives:</strong> The player starts with multiple lives (usually 5), losing one each time the ball falls below the paddle</li>
                            <li><strong>Speed Changes:</strong> The ball speed increases as more bricks are destroyed, making the game progressively harder</li>
                            <li><strong>Scoring:</strong> Different colored brick rows have different point values - higher rows (closer to top) are worth more points</li>
                            <li><strong>Score Display:</strong> The numbers on the screen show the current score and remaining lives</li>
                            <li><strong>Strategy:</strong> Advanced players often try to create a "tunnel" through one side to get the ball behind the brick wall for maximum efficiency</li>
                        </ul>
                    </div>
                    <p><strong>Remember:</strong> The goal is to analyze and understand the agent's strategy. If you find any part hard to interpret, that's normal—just do your best!</p>
                `,
                randomizationTitle: "Study Design",
                randomizationText: "To ensure unbiased results, the order of the two analysis methods will be randomized for each participant.",
                yourOrder: "Your randomized order:",
                startBtn: "Start Study",
                familiarizationTitle: "Stage 1: Familiarization with Agent Behavior",
                familiarizationDescription: `
                    <p>First, you will watch an unedited game video showing a complete performance of an AI playing Breakout.</p>
                    <p><strong>Tips:</strong> If you find the video too fast, feel free to pause, rewind, or adjust the speed. Focus on observing the agent's actions and try to spot any patterns or strategies.</p>
                    <p><strong>Your task:</strong> Try to form your own understanding of how the agent plays and what strategies it uses. This is the foundation for all later analysis. <br><span style="color:#4facfe;">Don't worry if you feel unsure—just describe what you see!</span></p>
                `,
                backBtn: "Back",
                continueBtn: "Continue",
                submitFirstBtn: "Submit Evaluation",
                submitSecondBtn: "Submit Evaluation",
                thankYouTitle: "Thank You!",
                thankYouMessage: "Thank you for participating in this study. Your responses have been recorded and will help us improve AI explanation systems. Please click the button below to download the results.",
                downloadBtn: "Download Results",
                hvaDescription: `
                    <div style="margin-bottom: 1em;"><strong>What is HVA-X?</strong><br>HVA-X is an AI analysis tool that generates a <strong>text report</strong> summarizing the agent’s strategies, strengths, weaknesses, and behavioral patterns. This report is the <strong>result of an algorithm</strong> trying to explain the agent's behavior in human language. <span style="color:#4facfe;">If you find the explanation unclear or hard to relate to the video, that's a limitation of the method, not your fault.</span></div>
                    <p>Read the report below and focus on how it helps (or doesn't help) you understand the agent's strategy. After reading, please answer the questions based on your own understanding.</p>
                    <div style="color:#4facfe;margin-top:10px;"><strong>Please do your best to use the provided materials/results to analyze and summarize the agent’s behavior and strategy.</strong></div>
                `,
                gradcamDescription: `
                    <div style="margin-bottom: 1em;"><strong>What is Grad-CAM?</strong><br>Grad-CAM is an <strong>analysis tool</strong> that uses visualization to show which areas of the game screen the agent “pays attention to” when making decisions. The video you see is the <strong>result of this method</strong>—not just a random overlay, but what the algorithm thinks are key areas for understanding the agent's strategy. <span style="color:#4facfe;">If you find the visualization hard to interpret, that's a limitation of the method, not your fault.</span></div>
                    <p>Watch the Grad-CAM video below and focus on what it reveals about the agent's behavior and strategy. <strong>If you find the content too fast, pause, rewind, or adjust the speed as needed.</strong></p>
                    <p>After watching, please answer the questions based on your own understanding. <span style="color:#4facfe;">If you feel confused, that's normal—just do your best!</span></p>
                    <div style="color:#4facfe;margin-top:10px;"><strong>Please do your best to use the provided materials/results to analyze and summarize the agent’s behavior and strategy.</strong></div>
                `,
                gradcamExplanation: "Understanding Grad-CAM",
                gradcamExplanationText: "Grad-CAM (Gradient-weighted Class Activation Mapping) is a visualization technique that highlights the areas in the game screen that most influence the AI's decisions. Warmer colors (red/yellow) indicate higher importance, showing where the AI 'looks' when making gameplay choices.",
                scaleLabels: {
                    left: "Strongly Disagree",
                    right: "Strongly Agree"
                },
                items: [
                    {
                        dimension: "1. Clarity",
                        statement: "This method/result clearly describes the agent's behavior and decisions."
                    },
                    {
                        dimension: "2. Understandability",
                        statement: "I can understand how the agent made its decisions based on this method/result."
                    },
                    {
                        dimension: "3. Completeness",
                        statement: "This method/result covers all important aspects of the agent's behavior."
                    },
                    {
                        dimension: "4. Satisfaction",
                        statement: "I'm satisfied with how well this method/result helps me understand the agent's behavior."
                    },
                    {
                        dimension: "5. Usefulness",
                        statement: "This method/result is useful for understanding the agent's gameplay and strategy."
                    },
                    {
                        dimension: "6. Accuracy",
                        statement: "The information accurately reflects the agent's actual behavior."
                    },
                    {
                        dimension: "7. Insightfulness",
                        statement: "This method/result reveals insights not obvious from just watching the full gameplay."
                    },
                    {
                        dimension: "8. Confidence",
                        statement: "I feel confident in my own understanding after using this method/result."
                    }
                ]
            },
            zh: {
                mainTitle: "AI分析比较研究",
                subtitle: "HVA-X文本分析 vs Grad-CAM可视化",
                introTitle: "欢迎与介绍",
                introDescription: `
                    <p><strong>欢迎！</strong> 本研究的核心目标是<strong>理解和分析游戏AI智能体的策略表现</strong>。所有视频、报告和方法，都是为了帮助您完成这个目标。<br><span style="color:#4facfe;">如果您觉得难以理解，请不要怀疑自己——有时AI的行为本身就很难解释，这属于算法的局限，而不是您的问题！</span></p>
                    <p>本次研究大约需要15分钟。您的主要任务是利用两种不同的AI分析工具，帮助自己理解<strong>智能体是如何玩游戏、采用了什么策略</strong>。请始终以“分析智能体策略”为目标，所有材料都是辅助工具。</p>
                    <p><strong>您将看到哪些材料？</strong> 您将首先观看一段智能体完整的原始游戏视频。随后，您会依次体验两种不同的AI分析方法（如文本报告和可视化），顺序为随机分配。每种材料都旨在帮助您分析和总结智能体的行为与策略。</p>
                    <div class="game-intro">
                        <h3>关于打砖块游戏</h3>
                        <p>在本研究中，AI玩的是经典街机游戏<strong>打砖块（Breakout）</strong>：</p>
                        <ul>
                            <li><strong>基本操作：</strong>玩家控制屏幕底部的挡板</li>
                            <li><strong>游戏机制：</strong>球在屏幕上弹跳，击碎顶部的砖块</li>
                            <li><strong>游戏目标：</strong>清除所有砖块，同时防止球掉到挡板下方</li>
                            <li><strong>生命系统：</strong>玩家开始时有多条生命（通常为5条），每次球掉到挡板下方会失去一条生命</li>
                            <li><strong>速度变化：</strong>随着更多砖块被摧毁，球的速度会增加，使游戏逐渐变难</li>
                            <li><strong>计分系统：</strong>不同颜色的砖块行有不同的分值——越高的行（越接近顶部）分值越高</li>
                            <li><strong>分数显示：</strong>屏幕上的数字显示当前分数和剩余生命数</li>
                            <li><strong>高级策略：</strong>高级玩家通常尝试在一侧创建“通道”，让球进入砖墙后方以获得最大效率</li>
                        </ul>
                    </div>
                    <p><strong>请记住：</strong>目标是分析和理解智能体的策略。如果觉得难以解释很正常——请尽力描述您的理解即可！</p>
                `,
                randomizationTitle: "研究设计",
                randomizationText: "为确保无偏见的结果，两种分析方法的顺序将为每位参与者随机化。",
                yourOrder: "您的随机顺序：",
                startBtn: "开始研究",
                familiarizationTitle: "阶段一：熟悉智能体行为",
                familiarizationDescription: `
                    <p>首先，您将观看一段未经剪辑的游戏视频，完整展示AI的游戏过程。</p>
                    <p><strong>提示：如果觉得视频过快，可以暂停、重播或调整速度。</strong>请关注智能体的行为，尝试发现其策略或规律。</p>
                    <p><strong>您的任务：</strong>请尽量形成自己对智能体策略和行为的理解，这将作为后续分析的基础。<br><span style="color:#4facfe;">如果觉得难以理解很正常——请如实描述您的观察！</span></p>
                `,
                backBtn: "返回",
                continueBtn: "继续",
                submitFirstBtn: "提交评估",
                submitSecondBtn: "提交评估",
                thankYouTitle: "谢谢！",
                thankYouMessage: "感谢您参与本次研究。您的回答已被记录，将帮助我们改进AI解释系统。请点击下方按钮下载结果。",
                downloadBtn: "下载结果",
                hvaDescription: `
                    <div style="margin-bottom: 1em;"><strong>什么是 HVA-X？</strong><br>HVA-X 是一种AI分析工具，会生成一份<strong>文本报告</strong>，总结智能体的策略、优缺点和行为模式。该报告是算法试图用人类语言解释智能体行为的<strong>方法结果</strong>。<span style="color:#4facfe;">如果您觉得报告难以理解或与视频不符，这属于方法本身的局限，而不是您的问题。</span></div>
                    <p>请阅读下方报告，关注它是否帮助您理解智能体的策略。阅读后请根据您的真实感受回答问题。</p>
                    <div style="color:#4facfe;margin-top:10px;"><strong>请尽力尝试通过这些材料/结果辅助分析和总结智能体的行为与策略。</strong></div>
                `,
                gradcamDescription: `
                    <div style="margin-bottom: 1em;"><strong>什么是 Grad-CAM？</strong><br>Grad-CAM 是一种<strong>分析工具</strong>，通过可视化展示智能体在决策时“关注”游戏画面的哪些区域。您看到的视频是<strong>方法的结果</strong>，不是随意叠加，而是算法认为有助于理解智能体策略的关键区域。<span style="color:#4facfe;">如果您觉得可视化难以理解，这属于方法本身的局限，而不是您的问题。</span></div>
                    <p>请观看下方Grad-CAM视频，关注它揭示了哪些智能体的行为和策略。<strong>提示：如果觉得内容过快，可暂停、重播或调整速度。</strong></p>
                    <p>观看后请根据您的真实理解回答问题。<span style="color:#4facfe;">如果觉得难以理解很正常——请如实作答！</span></p>
                    <div style="color:#4facfe;margin-top:10px;"><strong>请尽力尝试通过这些材料/结果辅助分析和总结智能体的行为与策略。</strong></div>
                `,
                gradcamExplanation: "理解Grad-CAM",
                gradcamExplanationText: "Grad-CAM（梯度加权类激活映射）是一种可视化技术，突显游戏屏幕中对AI决策影响最大的区域。暖色（红色/黄色）表示更高的重要性，展示AI在做出游戏决策时'关注'的位置。",
                scaleLabels: {
                    left: "非常不同意",
                    right: "非常同意"
                },
                items: [
                    {
                        dimension: "1. 清晰度 (Clarity)",
                        statement: "该方法/结果清晰地描述了智能体的行为和决策过程。"
                    },
                    {
                        dimension: "2. 可理解性 (Understandability)",
                        statement: "基于此方法/结果，我能理解智能体是如何做出决策的。"
                    },
                    {
                        dimension: "3. 完整性 (Completeness)",
                        statement: "该方法/结果涵盖了智能体行为的所有重要方面。"
                    },
                    {
                        dimension: "4. 满意度 (Satisfaction)",
                        statement: "我对该方法/结果帮助我理解智能体行为的程度感到满意。"
                    },
                    {
                        dimension: "5. 有用性 (Usefulness)",
                        statement: "该方法/结果对理解智能体的游戏策略很有帮助。"
                    },
                    {
                        dimension: "6. 准确性 (Accuracy)",
                        statement: "方法/结果中的信息准确反映了智能体的实际行为。"
                    },
                    {
                        dimension: "7. 洞察力 (Insightfulness)",
                        statement: "该方法/结果揭示了仅靠观看完整游戏难以察觉的洞察。"
                    },
                    {
                        dimension: "8. 信心 (Confidence)",
                        statement: "使用该方法/结果后，我对自己的理解更有信心。"
                    }
                ]
            }
        };

        // HVA-X Report Content (same as in highlights comparison)
        const hvaReportContent = {
            en: `
## Agent Evaluation Report: Breakout Specialist

### 1. Executive Summary

This agent is a highly specialized "tunneling" expert that consistently employs an optimal, high-risk strategy to clear bricks. Its primary strength lies in its sophisticated, proactive paddle control to set up these game-winning plays. However, this strategic brilliance is critically undermined by poor reactive defense, making it tactically brittle and vulnerable to high-speed balls and sharp-angled returns, leading to highly inconsistent performance outcomes.

### 2. Detailed Strategic Profile

Across all observed performance tiers, the agent demonstrates a singular and sophisticated strategic focus: **tunneling**. Rather than clearing bricks reactively, it proactively attempts to carve a channel on one side of the brick wall. The objective is to send the ball into the space behind the bricks, allowing it to destroy the highest-value upper rows automatically.

*   **High-Risk, High-Reward:** This is an inherently risky strategy that requires playing near the screen edges, minimizing the margin for error. However, when successful, it is the most efficient method for achieving a high score, as evidenced by the rapid point accumulation in mid and high-tier episodes.
*   **Strategic Consistency:** The agent's commitment to this strategy is its most consistent trait. It is applied at the start of every life, regardless of previous success or failure. This indicates a stable, well-defined policy that has identified the game's optimal long-term solution.
*   **Adaptation:** The agent shows clear phases in its strategy: (1) **Tunnel Creation**, (2) **Tunnel Exploitation**, and (3) **Cleanup**. It can adapt its target from one side of the screen to the other based on the evolving state of the brick wall, demonstrating a dynamic application of its core strategy.

### 3. Tactical Skill Assessment

The agent exhibits a stark duality in its paddle control, displaying expert proactive skill alongside alarmingly poor reactive skill.

*   **Key Strength (Proactive Angling):** The agent's greatest tactical asset is its ability to use the edges of the paddle to intentionally direct the ball. This advanced, proactive striking is not accidental; it is the fundamental skill that enables its entire tunneling strategy. It consistently demonstrates the ability to set up the precise, repeated shots needed to create a channel.

*   **Key Weakness (Reactive Defense):** The agent's primary point of failure is its inability to defend against the very conditions its own strategy creates. It consistently struggles with:
    *   **High Ball Velocity:** As the ball clears upper-tier bricks, its speed increases. The agent's reaction time is frequently insufficient to handle this, leading to misses.
    *   **Sharp-Angle Rebounds:** It has a significant blind spot for predicting the trajectory of balls rebounding sharply off the side walls, a common occurrence when playing a tunneling strategy.
    *   **Predictive Errors:** In multiple instances across all tiers, the agent misjudges even simple return paths, sometimes moving the paddle in the opposite direction of the ball, indicating a critical flaw in its state interpretation or predictive model under pressure.

### 4. Performance Analysis

The synthesis of multiple analyses reveals that the primary differentiator between performance tiers is not strategic intent, but **tactical execution and resilience**.

*   **Differentiators of Performance:**
    *   **High-Tier** episodes are defined by flawless execution of the initial tunneling setup. The agent successfully gets the ball behind the brick wall, guaranteeing a high score. Lives are typically lost *after* this phase, due to the resulting high-speed ball.
    *   **Low-Tier** episodes are characterized by tactical failures *during* the initial setup. The agent makes unforced errors in judgment or reaction time while trying to create the tunnel, leading to an early loss of lives and a low final score.
    *   **Mid-Tier** episodes represent a middle ground where the agent successfully creates a tunnel but lacks the resilience to manage the subsequent high-difficulty phase, leading to a higher miss rate than top-tier performances.

*   **Failure Modes & Miss Rate:** There is not a direct correlation between the final score and the number of lives lost. Some high-scoring episodes feature 3-4 lost lives. The crucial factor is *when* the lives are lost. A single life lost during the initial setup is more detrimental to the score than three lives lost during the final cleanup phase after the bulk of the bricks have been cleared. The most common failure mode in low-performing episodes is a basic misjudgment of a rebound angle or slow paddle movement during the critical setup phase.

### 5. Conclusion & Recommendations

The agent profiles as a **"glass cannon": strategically brilliant but tactically brittle.** It has mastered the optimal strategy for Breakout but has not developed the fundamental defensive skills required to support it reliably. Its performance is a coin flip between a masterful, efficient run and a quick, clumsy failure, entirely dependent on its ability to execute the first ~15 seconds of its plan without error.

**Recommendations for Improvement:**

1.  **Targeted Defensive Training:** The core tunneling strategy should be preserved. Training should focus exclusively on mitigating the agent's key weakness: reactive defense. A curriculum should be developed that presents the agent with increasingly difficult scenarios involving high-velocity balls and sharp-angled returns from the screen edges.
2.  **Improve Generalization:** To make the agent more robust, it should be trained in scenarios where tunneling is not immediately viable. This will force it to improve its general-purpose paddle control and trajectory prediction, rather than over-specializing in the setup routine.
3.  **Failure State Injection:** Intentionally inject game states from which the agent has previously failed (e.g., a fast ball coming from the top-right corner). Repeated training on these specific, known "blind spots" will help patch the most critical holes in its policy.`,
            zh: `
## 智能体评估报告：Breakout 专家型智能体

### 1. 执行摘要

该智能体是一名高度专业化的“打通通道”专家，始终如一地采用高风险、高回报的策略清除砖块。其主要优势在于对球拍的前瞻性控制能力，能够精确地设置出获胜路径。但这种战略天赋严重受限于其糟糕的反应性防御，使其在面对高速球和急角反弹时表现脆弱，导致整体表现极其不稳定。

### 2. 战略细节画像

在所有表现层级中，该智能体展现出一致且精细的战略重点：**打通通道（Tunneling）**。它并非被动地清除面前的砖块，而是主动尝试在一侧打出一条通道，目的是让球进入砖墙后方，从而自动清除上层高分砖块。

* \*\*高风险高回报：\*\*这是一种本质上具有高风险的策略，需在屏幕边缘附近操作，失误容忍度极低。但若成功，它是得分最高效的方式，这在中高层级的回合中已被高分证实。
* \*\*战略一致性：\*\*无论前一局成功与否，该策略始终在每条生命开始时被采用。这表明其策略稳定、明确，已找到游戏的最优长远解法。
* \*\*策略适应性：\*\*智能体在策略上表现出明显的三个阶段：（1）**通道构建**，（2）**通道利用**，（3）**残余清除**。它能根据砖墙状态从屏幕一侧切换至另一侧，展现出其核心策略的动态应用能力。

### 3. 战术技能评估

该智能体在球拍控制方面表现出明显的二元性：具备卓越的主动技能，却严重缺乏反应性防御能力。

* \*\*关键优势（主动角度控制）：\*\*智能体最大的战术优势在于利用球拍边缘有意识地控制球的方向。这种高级主动击球技巧并非偶然，而是其通道策略得以成立的基础。它多次展现出设置精准、重复打击的能力。
* \*\*关键劣势（反应性防御）：\*\*智能体的主要失败点是无法防守自己策略带来的后果，表现为：

  * \*\*高速球处理能力差：\*\*当球清除上层砖块后速度上升，智能体往往反应不及，频繁漏接；
  * \*\*急角反弹预测失败：\*\*面对来自侧墙的急角反弹球轨迹，它常常判断失误，形成明显盲点；
  * \*\*预测性错误：\*\*在多层级案例中，甚至面对简单回弹路径，智能体也会判断错误，有时甚至将球拍移向相反方向，反映其状态理解或预测模型在高压情境下存在严重缺陷。

### 4. 表现分析

多个分析的综合显示，**表现层级间的主要差异不在于战略意图，而在于战术执行力和抗压能力。**

* **表现层级关键差异：**

  * \*\*高表现等级：\*\*通道构建阶段执行无误，成功让球进入砖块后方，保证高分。丢命多数发生在高难度阶段之后。
  * \*\*低表现等级：\*\*在通道构建阶段即发生战术失误，如判断失误或反应不及时，导致早期失误和低分结局。
  * \*\*中等表现等级：\*\*成功打通通道，但后续高难度阶段缺乏稳定性，漏球率较高，得分居中。

* **失败模式与丢命分析：**最终得分与丢命数量无直接相关性。部分高分局中，智能体丢掉 3-4 条生命。关键在于**丢命发生的时机**：若在初始通道构建阶段丢命，对得分影响最大；而若在最后清理阶段丢命，即便多条，也影响较小。低表现主要因开局阶段处理失误，如反弹角度判断错误或球拍移动迟缓。

### 5. 结论与改进建议

该智能体属于\*\*“玻璃大炮”型角色：战略天赋极高，但战术极度脆弱。\*\*它已经掌握了Breakout游戏的最优策略，但尚未具备支撑该策略所需的基本防守能力。其表现极不稳定，在“精彩高分”与“快速失败”之间摇摆不定，完全取决于前 15 秒内是否能成功完成策略初始阶段。

**改进建议：**

1. \*\*专注防守训练：\*\*保留其通道策略，在此基础上开展强化防守训练。构建训练课程，专门呈现高速度球和屏幕边缘急角反弹等复杂场景，提升其反应能力。
2. \*\*提升泛化能力：\*\*在训练中加入通道策略不可行的场景，迫使其改进一般性球拍控制与轨迹预测，避免过度依赖特定起手套路。
3. \*\*失败状态注入：\*\*从历史失败案例中提取关键失败状态（如：高速球自右上角来袭），进行集中训练，有针对性地弥补策略漏洞。`
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(lang + '-btn').classList.add('active');
            updateContent();
        }

        function updateContent() {
            const t = translations[currentLanguage];
            
            // Update main titles
            document.getElementById('main-title').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            
            // Update phase 1 content
            document.getElementById('intro-title').textContent = t.introTitle;
            document.getElementById('intro-description').innerHTML = t.introDescription;
            document.getElementById('randomization-title').textContent = t.randomizationTitle;
            document.getElementById('randomization-text').textContent = t.randomizationText;
            document.getElementById('your-order').textContent = t.yourOrder;
            document.getElementById('start-btn').textContent = t.startBtn;
            
            // Update phase 2 content
            document.getElementById('familiarization-title').textContent = t.familiarizationTitle;
            document.getElementById('familiarization-description').innerHTML = t.familiarizationDescription;
            document.getElementById('back-btn').textContent = t.backBtn;
            document.getElementById('continue-btn').textContent = t.continueBtn;
            
            // Update other buttons
            document.getElementById('back-btn-2').textContent = t.backBtn;
            document.getElementById('submit-first-btn').textContent = t.submitFirstBtn;
            document.getElementById('back-btn-3').textContent = t.backBtn;
            document.getElementById('submit-second-btn').textContent = t.submitSecondBtn;
            
            // Update thank you page
            document.getElementById('thank-you-title').textContent = t.thankYouTitle;
            document.getElementById('thank-you-message').textContent = t.thankYouMessage;
            document.getElementById('download-btn').textContent = t.downloadBtn;
            
            // Update order display
            updateOrderDisplay();
            
            // Update phase 3 and 4 content based on randomization
            updatePhaseContent();
        }

        function updateOrderDisplay() {
            const orderText = randomizedOrder === 'hva-first' ? 
                (currentLanguage === 'en' ? 'HVA-X Text Report → Grad-CAM Visualization' : 'HVA-X文本报告 → Grad-CAM可视化') :
                (currentLanguage === 'en' ? 'Grad-CAM Visualization → HVA-X Text Report' : 'Grad-CAM可视化 → HVA-X文本报告');
            
            document.getElementById('order-display').textContent = orderText;
        }

        function updatePhaseContent() {
            const t = translations[currentLanguage];
            
            if (randomizedOrder === 'hva-first') {
                // First method: HVA-X, Second method: Grad-CAM
                document.getElementById('first-method-title').textContent = currentLanguage === 'en' ? 'Stage 2: Evaluate First Analysis Method (Text Report)' : '阶段二：评估第一份解释材料（文本报告）';
                document.getElementById('first-method-description').innerHTML = t.hvaDescription;
                document.getElementById('first-method-content').innerHTML = `
                    <div class="report-container">
                        <div class="report-content">${hvaReportContent[currentLanguage].replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>')}</div>
                    </div>
                `;
                
                document.getElementById('second-method-title').textContent = currentLanguage === 'en' ? 'Stage 3: Evaluate Second Analysis Method (Grad-CAM Visualization)' : '阶段三：评估第二份解释材料（Grad-CAM可视化）';
                document.getElementById('second-method-description').innerHTML = t.gradcamDescription;
                document.getElementById('second-method-content').innerHTML = generateGradCamContent();
            } else {
                // First method: Grad-CAM, Second method: HVA-X
                document.getElementById('first-method-title').textContent = currentLanguage === 'en' ? 'Stage 2: Evaluate First Analysis Method (Grad-CAM Visualization)' : '阶段二：评估第一份解释材料（Grad-CAM可视化）';
                document.getElementById('first-method-description').innerHTML = t.gradcamDescription;
                document.getElementById('first-method-content').innerHTML = generateGradCamContent();
                
                document.getElementById('second-method-title').textContent = currentLanguage === 'en' ? 'Stage 3: Evaluate Second Analysis Method (Text Report)' : '阶段三：评估第二份解释材料（文本报告）';
                document.getElementById('second-method-description').innerHTML = t.hvaDescription;
                document.getElementById('second-method-content').innerHTML = `
                    <div class="report-container">
                        <div class="report-content">${hvaReportContent[currentLanguage].replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>')}</div>
                    </div>
                `;
            }
        }

        function generateGradCamContent() {
            const t = translations[currentLanguage];
            return `
                <div class="gradcam-description">
                    <h4>${t.gradcamExplanation}</h4>
                    <p>${t.gradcamExplanationText}</p>
                </div>
                <div class="gradcam-container">
                    <video class="gradcam-video" controls>
                        <source src="videos/gradcam_video.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
            `;
        }

        function generateEvaluationForm(containerId, evaluationData) {
            const t = translations[currentLanguage];
            const container = document.getElementById(containerId);
            
            container.innerHTML = '';
            
            t.items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'evaluation-item';
                itemDiv.innerHTML = `
                    <div class="dimension-title">${item.dimension}</div>
                    <div class="statement">${item.statement}</div>
                    <div class="score-selection">
                        <div style="width: 100%;">
                            <div class="scale-labels">
                                <span>${t.scaleLabels.left}</span>
                                <span>${t.scaleLabels.right}</span>
                            </div>
                            <div class="score-buttons">
                                ${[1,2,3,4,5,6,7].map(score => `
                                    <button class="score-btn" onclick="selectScore('${containerId}', ${index}, ${score})" data-container="${containerId}" data-item="${index}" data-score="${score}">
                                        ${score}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
            
            // Restore selected scores
            Object.keys(evaluationData).forEach(itemIndex => {
                const score = evaluationData[itemIndex];
                const btn = document.querySelector(`[data-container="${containerId}"][data-item="${itemIndex}"][data-score="${score}"]`);
                if (btn) {
                    btn.classList.add('selected');
                }
            });
        }

        function selectScore(containerId, itemIndex, score) {
            // Remove previous selection for this item
            document.querySelectorAll(`[data-container="${containerId}"][data-item="${itemIndex}"]`).forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selection to clicked button
            document.querySelector(`[data-container="${containerId}"][data-item="${itemIndex}"][data-score="${score}"]`).classList.add('selected');
            
            // Store the score
            if (containerId === 'first-evaluation-form') {
                firstEvaluationData[itemIndex] = score;
            } else {
                secondEvaluationData[itemIndex] = score;
            }
        }

        function nextPhase() {
            if (currentPhase < 5) {
                document.getElementById(`phase-${currentPhase}`).classList.remove('active');
                currentPhase++;
                document.getElementById(`phase-${currentPhase}`).classList.add('active');
                updateProgressIndicator();
                
                // Generate evaluation forms when entering phase 3 or 4
                if (currentPhase === 3) {
                    generateEvaluationForm('first-evaluation-form', firstEvaluationData);
                } else if (currentPhase === 4) {
                    generateEvaluationForm('second-evaluation-form', secondEvaluationData);
                }
            }
        }

        function prevPhase() {
            if (currentPhase > 1) {
                document.getElementById(`phase-${currentPhase}`).classList.remove('active');
                currentPhase--;
                document.getElementById(`phase-${currentPhase}`).classList.add('active');
                updateProgressIndicator();
            }
        }

        function updateProgressIndicator() {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step-${i}`);
                step.classList.remove('active', 'completed');
                
                if (i < currentPhase) {
                    step.classList.add('completed');
                } else if (i === currentPhase) {
                    step.classList.add('active');
                }
            }
        }

        function submitFirstEvaluation() {
            const t = translations[currentLanguage];
            const totalItems = t.items.length;
            const completedItems = Object.keys(firstEvaluationData).length;
            
            if (completedItems < totalItems) {
                alert(currentLanguage === 'en' ? 
                    `Please complete all ${totalItems} evaluations. You have completed ${completedItems}/${totalItems}.` :
                    `请完成所有 ${totalItems} 项评估。您已完成 ${completedItems}/${totalItems} 项。`);
                return;
            }
            
            nextPhase();
        }

        function submitSecondEvaluation() {
            const t = translations[currentLanguage];
            const totalItems = t.items.length;
            const completedItems = Object.keys(secondEvaluationData).length;
            
            if (completedItems < totalItems) {
                alert(currentLanguage === 'en' ? 
                    `Please complete all ${totalItems} evaluations. You have completed ${completedItems}/${totalItems}.` :
                    `请完成所有 ${totalItems} 项评估。您已完成 ${completedItems}/${totalItems} 项。`);
                return;
            }
            
            nextPhase();
        }

        // Add global variable to track submission state
        let isSubmitting = false;
        let hasSubmitted = false;

        function submitToNetlify(firstEvaluationResult, secondEvaluationResult, results, timestamp) {
            // Prevent multiple submissions
            if (isSubmitting || hasSubmitted) {
                alert(currentLanguage === 'en' ? 
                    'Form has already been submitted or is currently being submitted.' :
                    '表单已经提交或正在提交中。');
                return;
            }
            
            // Set submission state
            isSubmitting = true;
            
            // Disable the download button to prevent multiple clicks
            const downloadBtn = document.querySelector('.download-btn');
            if (downloadBtn) {
                downloadBtn.disabled = true;
                downloadBtn.textContent = currentLanguage === 'en' ? 'Submitting...' : '提交中...';
            }
            
            // Get the hidden form
            const form = document.querySelector('form[name="study-results"]');
            
            // Populate form fields
            form.querySelector('[name="study-type"]').value = 'hva-gradcam';
            form.querySelector('[name="first-method"]').value = firstEvaluationResult.method;
            form.querySelector('[name="second-method"]').value = secondEvaluationResult.method;
            form.querySelector('[name="language"]').value = currentLanguage;
            form.querySelector('[name="order"]').value = randomizedOrder;
            form.querySelector('[name="timestamp"]').value = timestamp;
            form.querySelector('[name="results-json"]').value = JSON.stringify(results, null, 2);
            
            // Populate first evaluation scores
            const dimensionNames = ['Clarity', 'Understandable', 'Completeness', 'Satisfaction', 'Useful', 'Accuracy', 'Improvement', 'Preference'];
            dimensionNames.forEach((dimension, index) => {
                const fieldName = `first-${dimension.toLowerCase()}`;
                const fieldElement = form.querySelector(`[name="${fieldName}"]`);
                if (fieldElement) {
                    fieldElement.value = firstEvaluationResult.evaluations[dimension] || '';
                }
            });
            
            // Populate second evaluation scores
            dimensionNames.forEach((dimension, index) => {
                const fieldName = `second-${dimension.toLowerCase()}`;
                const fieldElement = form.querySelector(`[name="${fieldName}"]`);
                if (fieldElement) {
                    fieldElement.value = secondEvaluationResult.evaluations[dimension] || '';
                }
            });
            
            // Submit form via AJAX
            const formData = new FormData(form);
            
            fetch('/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(formData).toString()
            })
            .then(() => {
                hasSubmitted = true;
                alert(currentLanguage === 'en' ? 
                    'Results submitted successfully! Thank you for participating.' :
                    '结果提交成功！感谢您的参与。');
                
                // Update button to show completion
                if (downloadBtn) {
                    downloadBtn.textContent = currentLanguage === 'en' ? 'Submitted ✓' : '已提交 ✓';
                    downloadBtn.style.backgroundColor = '#27ae60';
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                isSubmitting = false; // Reset on error to allow retry
                
                // Re-enable button on error
                if (downloadBtn) {
                    downloadBtn.disabled = false;
                    downloadBtn.textContent = currentLanguage === 'en' ? 'Download Results' : '下载结果';
                }
                
                alert(currentLanguage === 'en' ? 
                    'Error submitting results. Please try again.' :
                    '提交结果时出错。请重试。');
            });
        }

        function downloadResults() {
            const firstMethodName = randomizedOrder === 'hva-first' ? 'HVA-X' : 'Grad-CAM';
            const secondMethodName = randomizedOrder === 'hva-first' ? 'Grad-CAM' : 'HVA-X';
            
            // Simplified dimension names in English only
            const dimensionNames = [
                'Clarity',
                'Understandable', 
                'Completeness',
                'Satisfaction',
                'Useful',
                'Accuracy',
                'Improvement',
                'Preference'
            ];
            
            // Create first evaluation JSON object
            const firstEvaluationResult = {
                method: firstMethodName,
                language: currentLanguage,
                order: randomizedOrder,
                timestamp: new Date().toISOString(),
                evaluations: {}
            };
            
            // Add first evaluation data
            dimensionNames.forEach((dimension, index) => {
                const score = firstEvaluationData[index];
                firstEvaluationResult.evaluations[dimension] = score;
            });
            
            // Create second evaluation JSON object
            const secondEvaluationResult = {
                method: secondMethodName,
                language: currentLanguage,
                order: randomizedOrder,
                timestamp: new Date().toISOString(),
                evaluations: {}
            };
            
            // Add second evaluation data
            dimensionNames.forEach((dimension, index) => {
                const score = secondEvaluationData[index];
                secondEvaluationResult.evaluations[dimension] = score;
            });
            
            // Combine into a list
            const results = [firstEvaluationResult, secondEvaluationResult];
            
            // Convert to JSON string
            const jsonContent = JSON.stringify(results, null, 2);
            
            // Generate timestamp in YYYYMMDD_HHMMSS format
            const now = new Date();
            const pad = n => n.toString().padStart(2, '0');
            const timestamp = `${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}`;
            
            // Submit to Netlify Forms
            submitToNetlify(firstEvaluationResult, secondEvaluationResult, results, timestamp);
        }



        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateContent();
            updateProgressIndicator();
        });
    </script>
</body>
</html> 